<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Adjust alignment to prevent content from being too high */
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        #slipForm, #resultContainer {
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            padding: 2.5rem;
            width: 100%;
            max-width: 500px;
        }
        input[type="text"], input[type="number"] {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            transition: border-color 0.2s;
        }
        input[type="text"]:focus, input[type="number"]:focus {
            border-color: #3b82f6; /* Blue-500 */
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
        }
        button {
            border-radius: 8px;
            transition: background-color 0.2s, transform 0.1s;
        }
        button:hover:enabled {
            transform: translateY(-1px);
        }
        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 2.5rem 1.5rem;
            transition: border-color 0.2s, background-color 0.2s;
        }
        .file-upload-area:hover {
            border-color: #9ca3af; /* Gray-400 */
            background-color: #f9fafb; /* Gray-50 */
        }
        #imagePreview {
            border-radius: 8px;
            object-fit: contain;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        #status.success {
            background-color: #dcfce7; /* Green-100 */
            border-color: #22c55e; /* Green-500 */
            color: #166534; /* Green-800 */
            font-weight: 600;
        }
        #status.error {
            background-color: #fee2e2; /* Red-100 */
            border-color: #ef4444; /* Red-500 */
            color: #991b1b; /* Red-800 */
            font-weight: 600;
        }
        #status.info {
            background-color: #e0f2fe; /* Blue-100 */
            border-color: #3b82f6; /* Blue-500 */
            color: #1e40af; /* Blue-800 */
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

  <div class="w-full max-w-lg space-y-8">
    <!-- ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö -->
    <form id="slipForm" class="bg-white rounded-xl shadow-lg p-8 space-y-6" onsubmit="return false;">
      <h2 class="text-3xl font-extrabold text-gray-900 text-center mb-6">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ</h2>

     <label class="block">
        <span class="mb-2 block text-sm font-medium text-gray-700">‡∏£‡∏´‡∏±‡∏™‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö (‡πÄ‡∏ä‡πà‡∏ô 014 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SCB) <span class="text-red-500">*</span></span>
        <input id="bank_receive" type="text" class="w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 014" required>
      </label>
      <label class="block">
        <span class="mb-2 block text-sm font-medium text-gray-700">‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö <span class="text-red-500">*</span></span>
        <input id="account_name" type="text" class="w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á" required>
      </label>
      <label class="block">
        <span class="mb-2 block text-sm font-medium text-gray-700">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô <span class="text-red-500">*</span></span>
        <input id="amount" type="number" min="0" step="0.01" class="w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô" required>
      </label>


      <div>
        <input id="imageInput" type="file" accept="image/*" class="sr-only">
        <div onclick="document.getElementById('imageInput').click()" class="file-upload-area flex flex-col items-center justify-center gap-4 text-center cursor-pointer border-2 border-dashed border-gray-300 p-6 rounded-lg bg-gray-50">
          <i class="fas fa-cloud-upload-alt text-5xl text-blue-500"></i>
          <p class="text-gray-700 font-medium">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏•‡∏≤‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏•‡∏¥‡∏õ‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
          <p class="text-sm text-gray-500">‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå JPG, PNG</p>
          <img id="imagePreview" class="mt-4 max-h-64 hidden object-contain transition-all duration-300 ease-in-out" alt="‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á">
        </div>
      </div>

      <button id="submitBtn" onclick="checkSlip()" disabled class="w-full bg-blue-600 py-3 text-white font-semibold text-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300">
        ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ
      </button>

      <div id="loading" class="hidden text-center mt-4">
        <i class="fas fa-spinner fa-spin text-3xl text-blue-600"></i>
        <p class="text-gray-600 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏•‡∏¥‡∏õ...</p>
      </div>
    </form>

    <!-- ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå -->
    <div id="resultContainer" class="hidden bg-white rounded-xl shadow-lg p-8 mt-6">
      <div id="status" class="mb-5 p-4 rounded-lg text-center font-semibold text-lg border-2"></div>
      <div id="summaryBox" class="mb-5 text-gray-800 text-sm leading-relaxed whitespace-pre-wrap"></div>
      <h3 class="text-lg font-semibold text-gray-800 mb-3">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ:</h3>
      <pre id="result" class="whitespace-pre-wrap break-words rounded-lg bg-gray-50 p-4 text-sm text-gray-800 border border-gray-200"></pre>
    </div>
  </div>

  <!-- Axios -->
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <script>
    const imgInput = document.getElementById('imageInput');
    const imgPreview = document.getElementById('imagePreview');
    const submitBtn = document.getElementById('submitBtn');

    imgInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (evt) => {
        imgPreview.src = evt.target.result;
        imgPreview.classList.remove('hidden');
        submitBtn.disabled = false;
      };
      reader.readAsDataURL(file);
    });

    async function checkSlip() {
      const img = imgPreview.src;
      const amountInput = document.getElementById('amount').value.trim();
      const bankReceiveInput = document.getElementById('bank_receive').value.trim();
      const accountNameInput = document.getElementById('account_name').value.trim();
      const loading = document.getElementById('loading');
      const statusBox = document.getElementById('status');
      const resultBox = document.getElementById('result');
      const resultContainer = document.getElementById('resultContainer');
      const summaryBox = document.getElementById('summaryBox');

      if (!img) return;

      loading.classList.remove('hidden');
      submitBtn.disabled = true;
      resultContainer.classList.add('hidden');
      summaryBox.innerText = '';

      let endpoint = 'https://slip-c.oiioioiiioooioio.download/api/slip';
      if (amountInput) endpoint += `/${amountInput}`;

      try {
        const response = await axios.post(endpoint, { img });
        const slip = response.data.data;

        let isValid = true;
        let reasons = [];

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
        if (amountInput) {
          const expected = parseFloat(amountInput);
          const received = parseFloat(slip.amount);
          if (Math.abs(expected - received) > 0.01) {
            isValid = false;
            reasons.push(`üí∞ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (‡∏Å‡∏£‡∏≠‡∏Å: ${expected} / ‡∏™‡∏•‡∏¥‡∏õ: ${received})`);
          }
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£
        if (bankReceiveInput && slip.receiver_bank !== bankReceiveInput) {
          isValid = false;
          reasons.push(`üè¶ ‡∏£‡∏´‡∏±‡∏™‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (‡∏Å‡∏£‡∏≠‡∏Å: ${bankReceiveInput} / ‡∏™‡∏•‡∏¥‡∏õ: ${slip.receiver_bank})`);
        }

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
        if (accountNameInput && slip.receiver_name.toLowerCase() !== accountNameInput.toLowerCase()) {
          isValid = false;
          reasons.push(`üë§ ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô (‡∏Å‡∏£‡∏≠‡∏Å: ${accountNameInput} / ‡∏™‡∏•‡∏¥‡∏õ: ${slip.receiver_name})`);
        }

        statusBox.className = 'mb-5 p-4 rounded-lg text-center font-semibold text-lg border-2';

        if (isValid) {
          statusBox.classList.add('bg-green-100', 'text-green-800', 'border-green-500');
          statusBox.textContent = '‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ‡∏™‡∏•‡∏¥‡∏õ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';

          const dateObj = new Date(slip.date);
          const dateStr = dateObj.toLocaleDateString('th-TH', { day: '2-digit', month: 'short', year: 'numeric' });
          const timeStr = dateObj.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

          summaryBox.innerText = [
            `‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à`,
            `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${dateStr}`,
            `‡πÄ‡∏ß‡∏•‡∏≤: ${timeStr} ‡∏ô.`,
            `‡∏à‡∏≤‡∏Å: ${slip.sender_name}`,
            ``,
            `‡πÑ‡∏õ‡∏¢‡∏±‡∏á: ${slip.receiver_name}`,
            `‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£: ${slip.receiver_bank_details?.name || '-'}`,
            `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô: ${Number(slip.amount).toLocaleString('th-TH', { minimumFractionDigits: 2 })} ‡∏ö‡∏≤‡∏ó`
          ].join('\n');
        } else {
          statusBox.classList.add('bg-red-100', 'text-red-800', 'border-red-500');
          statusBox.innerHTML = `‚ùå ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô:<br><span class="text-sm font-normal">${reasons.join('<br>')}</span>`;
          summaryBox.innerText = '';
        }

        resultBox.textContent = JSON.stringify(slip, null, 2);

      } catch (err) {
        statusBox.className = 'mb-5 p-4 rounded-lg text-center font-semibold text-lg border-2 bg-yellow-100 text-yellow-800 border-yellow-500';
        statusBox.textContent = err.response?.data?.error || '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ';
        resultBox.textContent = '';
        summaryBox.innerText = '';
      } finally {
        loading.classList.add('hidden');
        submitBtn.disabled = false;
        resultContainer.classList.remove('hidden');
      }
    }
  </script>
</body>
</html>
